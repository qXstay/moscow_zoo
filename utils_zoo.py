from telebot.types import InlineKeyboardMarkup, InlineKeyboardButton
import random

class AnimalQuiz:
    def __init__(self):
        self.questions = [
            {
                "question": "Какой ваш любимый тип местности?",
                "options": ["Лес", "Саванна", "Горы", "Степь"],
                "weights": [1, 2, 3, 4]
            },
            {
                "question": "Вы предпочитаете день, ночь или сумерки?",
                "options": ["День", "Ночь", "Сумерки"],
                "weights": [1, 2, 3]
            },
            {
                "question": "Что вы предпочитаете есть?",
                "options": ["Мясо", "Растения", "Всеядный"],
                "weights": [3, 1, 2]
            },
            {
                "question": "Как вы предпочитаете двигаться?",
                "options": ["Быстро", "Медленно", "Средне"],
                "weights": [3, 1, 2]
            },
            {
                "question": "Какую погоду вы предпочитаете?",
                "options": ["Солнечно", "Дождливо", "Снежно"],
                "weights": [1, 2, 3]
            },
            {
                "question": "Какое ваше любимое время года?",
                "options": ["Весна", "Лето", "Осень", "Зима"],
                "weights": [1, 2, 3, 4]
            },
        ]
        self.animal_preferences = {
            "Фенек": {
                "score": 10,
                "terrain": ["Лес", "Степь"],
                "diet": ["Всеядный"],
                "weights": [3, 2, 1, 1, 1, 1]
            },
            "Ушастая сова": {
                "score": 8,
                "terrain": ["Лес"],
                "diet": ["Всеядный"],
                "weights": [2, 1, 0, 1, 1, 1]
            },
            "Капибара": {
                "score": 7,
                "terrain": ["Лес", "Степь"],
                "diet": ["Растения"],
                "weights": [1, 0, 2, 1, 1, 1]
            },
            "Азиатский слон": {
                "score": 9,
                "terrain": ["Саванна"],
                "diet": ["Растения"],
                "weights": [0, 1, 2, 1, 1, 1]
            },
            "Европейский волк": {
                "score": 8,
                "terrain": ["Горы", "Степь"],
                "diet": ["Мясо"],
                "weights": [1, 0, 3, 1, 1, 1]
            },
            "Дальневосточный леопард": {
                "score": 9,
                "terrain": ["Саванна", "Горы"],
                "diet": ["Мясо"],
                "weights": [1, 0, 3, 1, 1, 1]
            },
            "Степной орёл": {
                "score": 6,
                "terrain": ["Степь"],
                "diet": ["Мясо"],
                "weights": [0, 1, 2, 1, 1, 1]
            },
            "Кот Манул": {
                "score": 7,
                "terrain": ["Горы"],
                "diet": ["Мясо"],
                "weights": [1, 1, 2, 0, 1, 1]
            },
            "Белый медведь": {
                "score": 10,
                "terrain": ["Полярные"],
                "diet": ["Всеядный"],
                "weights": [0, 2, 1, 0, 1, 1]
            },
            "Фиолетовый турако": {
                "score": 5,
                "terrain": ["Тропические"],
                "diet": ["Растения"],
                "weights": [0, 0, 3, 1, 1, 1]
            },
            "Уссурийская харза": {
                "score": 6,
                "terrain": ["Лес", "Горы"],
                "diet": ["Всеядный"],
                "weights": [2, 1, 1, 0, 1, 1]
            },
            "Даман брюса": {
                "score": 5,
                "terrain": ["Горы"],
                "diet": ["Растения"],
                "weights": [0, 1, 2, 0, 1, 1]
            }
        }

    def determine_animal(self, answers):
        total_scores = {animal: 0 for animal in self.animal_preferences.keys()}

        for i, answer in enumerate(answers):
            for animal, preferences in self.animal_preferences.items():
                total_scores[animal] += preferences["weights"][answer]

                # Бонус за местность
                if self.questions[0]["options"][answers[0]] in preferences["terrain"]:
                    total_scores[animal] += 5  # Значительный бонус

                # Бонус за диету
                if self.questions[2]["options"][answers[2]] in preferences["diet"]:
                    total_scores[animal] += 5  # Значительный бонус

        # Рандомизация: добавляем небольшую вариацию к score
        for animal in total_scores:
            total_scores[animal] += random.randint(-2, 2)

        # Определяем животное с наивысшим баллом
        best_animal = max(total_scores, key=total_scores.get)
        best_score = total_scores[best_animal]

        if best_score == 0:
            return "Неизвестно", None, "Описание недоступно."
        return best_animal, self.get_animal_image(best_animal), self.get_animal_description(best_animal)

    def get_animal_image(self, animal_name):
        animal_images = {
            "Фенек": "C:/Users/user/projects/zoo/Fenek.jpg",
            "Ушастая сова": "C:/Users/user/projects/zoo/Sova.jpg",
            "Капибара": "C:/Users/user/projects/zoo/Capybara.webp",
            "Азиатский слон": "C:/Users/user/projects/zoo/Asian.jpg",
            "Европейский волк": "C:/Users/user/projects/zoo/Wolf.jpg",
            "Дальневосточный леопард": "C:/Users/user/projects/zoo/Leopard.jpg",
            "Степной орёл": "C:/Users/user/projects/zoo/Orel.jpg",
            "Кот Манул": "C:/Users/user/projects/zoo/Manul.jpg",
            "Белый медведь": "C:/Users/user/projects/zoo/Medved.jpg",
            "Фиолетовый турако": "C:/Users/user/projects/zoo/Turako.jpg",
            "Уссурийская харза": "C:/Users/user/projects/zoo/Harza.jpg",
            "Даман брюса": "C:/Users/user/projects/zoo/Daman.jpg"
        }
        return animal_images.get(animal_name, None)

    def get_animal_description(self, animal_name):
        descriptions = {
            "Степной орёл": "Степной орёл oтносится к небольшому отряду cоколообразных, это гордая, крупная, хищная птица."
                            "Образ орла всегда связывали с храбростью, величием и мужественностью - достаточно видеть, "
                            "как летит эта птица, рассекая воздушные потоки.\n\nИнтересный факт: Свою добычу степной орел может рассмотреть"
                            "на расстояние двух километров. А Во время парения степной орел может развивать скорость до двухсот сорока километров в час.",

            "Азиатский слон": "Слона невозможно спутать ни с каким другим животным – серый могучий гигант с огромными ушами и хоботом – удивительным органом,"
                              "аналогов которому нет в животном мире. Азиатский слон - самое крупное наземное животное в Азии.\n\n"
                              "Интересный факт: Новорожденным слонам требуется всего 20 минут, чтобы встать на ноги после рождения, и уже"
                              "через час они могут делать свои первые шаги.Через два дня они будут способны не отставать от стада.",

            "Европейский волк": "Волк – наиболее крупное животное среди представителей семейства псовых, мощное, пропорционально сложенное. "
                                "Длина тела в среднем 105-160 см,высота в плечах 80-85, иногда до 100 см, масса тела 32-50 кг.Органы чувств у волка развиты великолепно. "
                                "Хорошо развитая высшая нервная деятельность сочетается у него с силой, ловкостью, быстротой бега и другими физическими данными, сильно "
                                "повышающими шансы этого хищника в борьбе за существование.\n\nИнтересный факт: Волки могут достаточно быстро бегать,"
                                "развивая скорость до 55–60 км/ч. За ночь стая может преодолеть расстояние в 60–80 км.",

            "Дальневосточный леопард": "Самая редкая в мире крупная кошка, численность которой в природе немногим более 100 особей."
                                       "Эта замечательно красивая кошка обладает гибким, стройным и вместе с тем вытянутым телом, округлой головой, длинным хвостом, стройными, "
                                       "очень сильными ногами.Леопардам вполне хватает жидкости, которую они получают с пищей, поэтому потребности часто пить воду у них нет."
                                       "Леопард способен затащить на высокое дерево добычу весом, в 3 раза превышающим собственный.\n\nИнтересный факт: Рисунок на шкуре каждого "
                                       "леопарда индивидуален и неповторим, как отпечатки пальцев у человека",

            "Кот Манул": "Манул практически не приручается, не становятся ручными даже рождённые в неволе котята.Крайне скрытная кошка. Из-за этой особенности остаётся вне поля"
                         " зрения исследователей даже в районах с наибольшей численностью. Манул обладает поразительной способность искусно затаиваться. Даже зная место, где"
                         " затаился зверь, его чрезвычайно трудно найти. Уходя от преследования, спасается бегством, но при первой же возможности уходит в нору или прячется "
                         "между камней.\n\nИнтересный факт: Манул увеличивается зимой. Манулу жизненно важно набрать вес за осень — специалисты называют это «жированием». "
                         "Если обычный манул весит 3–5 килограммов, то его зимняя версия — 6–7 килограммов. При этом в холода он больше обычного бегает в поисках пищи.",

            "Фенек": "Миниатюрная лисица с крупными относительно тела ушами.Такие большие уши нужны фенеку не только чтобы по малейшему шороху в песке узнавать о передвижении"
                     " своей основной добычи — насекомых и мелких позвоночных, но и для лучшего охлаждения тела в дневную жару. Фенеки — социальные животные и могут жить в "
                     "группах до 10 особей\n\nИнтересный факт: Фенеки могут жить без воды на протяжении длительных периодов времени, получая воду из пищи. Они также могут "
                     "выдерживать высокие температуры в пустыне благодаря своей способности переносить жару",

            "Белый медведь": "Белый медведь - самый крупный наземный представитель млекопитающих отряда хищных. Настоящий хозяин Арктики."
                             "У этого зверя очень сильные лапы с большими когтями. Нам шерсть медведя кажется белой, но на самом деле, каждая шерстинка на теле зверя прозрачная и"
                             " полая внутри. Белой она «становится» благодаря лучам света, проходящими сквозь неё. Самки, имеющие маленьких медвежат чрезвычайно лояльны к осиротевшим"
                             " детёнышам: известны случаи, когда самки принимали и выкармливали их вместе с родными.\n\nИнтересный факт: В книге рекордов зарегистрировано уникальное "
                             "достижение. Белый медведь смог проплыть без единой остановки на отдых 687 км. Обычным делом считается для белого медведя за один раз проплывать более 100 км",

            "Ушастая сова": "Весь день ушастая сова спит, сидя на ветке, вытянувшись и прижимаясь к стволу дерева. Заметить её в таком положении почти невозможно."
                            " На голове выделяются пучки перьев длиной до 6 см, которые сова может поднимать, опускать или плотно прижимать к голове. За эти «ушки» она и получила своё "
                            "название. Эти «ушки» не являются органами слуха, хотя, безусловно, помогают сове улавливать звуки из окружающей среды.Ушастые совы имеют целых три пары век. "
                            "Одни используются во время полёта для защиты глаз от попадания частичек пыли и мошек, другие для моргания, а третьи для сна.\n\nИнтересный факт: Ушастые совы"
                            " никогда не строят гнёзд, а селятся в брошенных гнёздах других птиц. При этом при выборе гнезда в первую очередь опирается на его маскировку. Впрочем, эти совы"
                            " охотно селятся и в искусственных домиках, созданных людьми.",

            "Капибара": "Капибара — самый крупный современный грызун, по-другому её называют водосвинкой. Взрослая особь может достигать в весе до 65 кг, а тело может достигать 1,35 метров "
                        "в длину и 60 см в высоту. Капибары очень говорливы. Для общения между собой они используют разные звуки, которые напоминают лай собаки, хрюканье, мурлыканье, свист, визжание."
                        "Капибары на 100% безобидны. Предпочитают спокойную и тихую жизнь в своей стае, питаются исключительно растениями и травой.\n\nИнтересный факт: При всей своей флегматичности и "
                        "кажущейся медлительности, капибара – очень быстрое животное. Представляете, они могут удирать со скоростью до 35 км/ч. Для сравнения – средняя скорость, которую развивают "
                        "профессиональные бегуны, равна примерно 30-40 км/ч. Представляете, как может носиться эта водосвинка?",

            "Фиолетовый турако": "Красивая и экзотическая и необыкновенная птица. На голове короткий красный хохол, на крыльях красные «зеркальца». За глазом проходит белая полоса.Крик фиолетового "
                                 "гологлазого турако представляет собой длинную серию булькающих звуков, словно бы переходящих друг в друга. Этот эффект возникает потому, что, как правило, одновременно"
                                 " кричат 2 птицы, исполняющие своеобразный дуэт.\n\nИнтересный факт: Ещё не умея летать, птенцы турако покидают гнездо, несмотря на то, что оно находится на дереве. На "
                                 "втором пальце крыла у них есть хорошо развитый коготь, который помогает им лазать по деревьям. Малыши выползают из гнезда, цепляясь за ветки, и лишь через неделю начинают"
                                 " перепархивать с ветки на ветку.",

            "Уссурийская харза": "Уссурийская харза — это самое крупное хищное млекопитающее из семейства куньих. Обладатель самой яркой окраски среди свих представителей.Такая экзотическая раскраска, "
                                 "характерная для тропических зверей, досталась уссурийской кунице неспроста — благодаря ей другие, более крупные, хищники не стремятся охотиться на харзу. Харза быстро бегает,"
                                 " стремительно лазает по деревьям и ловко перепрыгивает с ветки на ветку. В этом ей помогают длинные острые когти, на удивление подвижные пальцы и крупные мощные лапы.\n\n"
                                 "Перепрыгивая с дерева на дерево, зверь делает скачки до 4 метров.",

            "Даман брюса": "Этот зверёк скромных размеров – ближайший родственник африканских слонов! Даманы действительно находятся в родстве со слонами, но это не значит, что даман – маленький слон. Просто у "
                           "даманов с хоботными и сиренами (дюгонями и ламантинами) в древности были общие предки. подошвы лап дамана специализированы для передвижения по гладким камням — они оголённые и влажные "
                           "от секреции кожных желёз, а устройство мускулатуры позволяет ступне принимать форму присоски.\n\nИнтересный факт: Благодаря особому строению органов зрения они могут смотреть прямо на "
                           "солнце без солнцезащитных очков и даже не прищуриваясь. Это помогает им вовремя обнаружить опасность с воздуха и скрыться с глаз долой."
        }

        return descriptions.get(animal_name, "Описание недоступно.")

